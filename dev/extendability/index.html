<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Extendability · Raytracer.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Raytracer.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Raytracer.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><span class="tocitem">Quickstart</span><ul><li><a class="tocitem" href="../quickstart/cli/">Basic CLI usage</a></li><li><a class="tocitem" href="../quickstart/scenelang/">Basic SceneLang usage</a></li><li><a class="tocitem" href="../quickstart/api/">Basic API usage</a></li></ul></li><li><a class="tocitem" href="../scenelang/">SceneLang</a></li><li><a class="tocitem" href="../cli/">CLI tool</a></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../api/high-level/">High-level API</a></li><li><a class="tocitem" href="../api/low-level/">Low-level API</a></li></ul></li><li class="is-active"><a class="tocitem" href>Extendability</a><ul class="internal"><li><a class="tocitem" href="#Contents"><span>Contents</span></a></li><li><a class="tocitem" href="#Description"><span>Description</span></a></li><li><a class="tocitem" href="#Renderers"><span>Renderers</span></a></li><li><a class="tocitem" href="#Pigments"><span>Pigments</span></a></li><li><a class="tocitem" href="#BRDFs"><span>BRDFs</span></a></li><li><a class="tocitem" href="#Shapes"><span>Shapes</span></a></li><li><a class="tocitem" href="#Examples-of-extendability"><span>Examples of extendability</span></a></li></ul></li><li><span class="tocitem">For devs</span><ul><li><a class="tocitem" href="../devs/collab/">Collaboration instructions</a></li><li><a class="tocitem" href="../devs/private-api/">Private API</a></li><li><a class="tocitem" href="../devs/scenelang-api/">SceneLang interpreter API</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Extendability</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Extendability</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Paolo97Gll/Raytracer.jl/blob/master/docs/src/extendability.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="extendability"><a class="docs-heading-anchor" href="#extendability">Extendability</a><a id="extendability-1"></a><a class="docs-heading-anchor-permalink" href="#extendability" title="Permalink"></a></h1><h2 id="Contents"><a class="docs-heading-anchor" href="#Contents">Contents</a><a id="Contents-1"></a><a class="docs-heading-anchor-permalink" href="#Contents" title="Permalink"></a></h2><ul><li><a href="#extendability">Extendability</a></li><ul><li><a href="#Contents">Contents</a></li><li><a href="#Description">Description</a></li><li><a href="#Renderers">Renderers</a></li><li><a href="#Pigments">Pigments</a></li><li><a href="#BRDFs">BRDFs</a></li><li><a href="#Shapes">Shapes</a></li><li><a href="#Examples-of-extendability">Examples of extendability</a></li></ul></ul><h2 id="Description"><a class="docs-heading-anchor" href="#Description">Description</a><a id="Description-1"></a><a class="docs-heading-anchor-permalink" href="#Description" title="Permalink"></a></h2><p>Raytracer is designed to be easily extensible in terms of renderers, pigments, BRDFs, and shapes. To extend the package, one must follow the following guidelines.</p><h2 id="Renderers"><a class="docs-heading-anchor" href="#Renderers">Renderers</a><a id="Renderers-1"></a><a class="docs-heading-anchor-permalink" href="#Renderers" title="Permalink"></a></h2><h5 id="Needed-fields"><a class="docs-heading-anchor" href="#Needed-fields">Needed fields</a><a id="Needed-fields-1"></a><a class="docs-heading-anchor-permalink" href="#Needed-fields" title="Permalink"></a></h5><p>No fields are strictly needed, but it is suggested to have a <a href="../api/low-level/#Raytracer.World"><code>World</code></a> field, named <code>world</code> for code consistency, in which to store the shapes to be rendered. It is also common to store a background color that deals with rays which do not hit any shape.</p><h5 id="Needed-methods"><a class="docs-heading-anchor" href="#Needed-methods">Needed methods</a><a id="Needed-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Needed-methods" title="Permalink"></a></h5><p>Each subtype of <a href="../api/low-level/#Raytracer.Renderer"><code>Renderer</code></a> must be a callable like <code>(r::Renderer)(ray::Ray)</code> and must return a <code>RGB{Float32}</code>.</p><h5 id="Further-notes"><a class="docs-heading-anchor" href="#Further-notes">Further notes</a><a id="Further-notes-1"></a><a class="docs-heading-anchor-permalink" href="#Further-notes" title="Permalink"></a></h5><p>See doc and source code for <a href="../api/low-level/#Raytracer.Renderer"><code>Renderer</code></a>.</p><h2 id="Pigments"><a class="docs-heading-anchor" href="#Pigments">Pigments</a><a id="Pigments-1"></a><a class="docs-heading-anchor-permalink" href="#Pigments" title="Permalink"></a></h2><h5 id="Needed-fields-2"><a class="docs-heading-anchor" href="#Needed-fields-2">Needed fields</a><a class="docs-heading-anchor-permalink" href="#Needed-fields-2" title="Permalink"></a></h5><p>No fields are needed.</p><h5 id="Needed-methods-2"><a class="docs-heading-anchor" href="#Needed-methods-2">Needed methods</a><a class="docs-heading-anchor-permalink" href="#Needed-methods-2" title="Permalink"></a></h5><p>Each subtype of <a href="../api/low-level/#Raytracer.Pigment"><code>Pigment</code></a> must be a callable like <code>(p::Pigment)(uv::Vec2D)</code> and must return a <code>RGB{Float32}</code>.</p><h5 id="Further-notes-2"><a class="docs-heading-anchor" href="#Further-notes-2">Further notes</a><a class="docs-heading-anchor-permalink" href="#Further-notes-2" title="Permalink"></a></h5><p>See doc and souce code for <a href="../api/low-level/#Raytracer.Pigment"><code>Pigment</code></a>.</p><h2 id="BRDFs"><a class="docs-heading-anchor" href="#BRDFs">BRDFs</a><a id="BRDFs-1"></a><a class="docs-heading-anchor-permalink" href="#BRDFs" title="Permalink"></a></h2><h5 id="Needed-fields-3"><a class="docs-heading-anchor" href="#Needed-fields-3">Needed fields</a><a class="docs-heading-anchor-permalink" href="#Needed-fields-3" title="Permalink"></a></h5><ul><li><code>pigment::Pigment</code>: a <a href="../api/low-level/#Raytracer.Pigment"><code>Pigment</code></a> storing the pigment on which the BRDF operates. It is suggested that this field should have a default value (most BRDFs use the default <a href="../api/low-level/#Raytracer.UniformPigment"><code>UniformPigment</code></a>).</li></ul><h5 id="Needed-methods-3"><a class="docs-heading-anchor" href="#Needed-methods-3">Needed methods</a><a class="docs-heading-anchor-permalink" href="#Needed-methods-3" title="Permalink"></a></h5><p>Each subtype of <a href="../api/low-level/#Raytracer.BRDF"><code>BRDF</code></a> must implement an <code>at(::NewBRDF, ::Normal, in_dir::Vec, out_dir::Vec, uv::Vec2D)</code> function, where <code>NewBRDF</code> should be swubstituted with your new type name. This function evaluates the BRDF of a point with given normal, input and output directions and uv coordinates (which are used to evaluate).</p><h5 id="Further-notes-3"><a class="docs-heading-anchor" href="#Further-notes-3">Further notes</a><a class="docs-heading-anchor-permalink" href="#Further-notes-3" title="Permalink"></a></h5><p>See doc and souce code for <a href="../api/low-level/#Raytracer.BRDF"><code>BRDF</code></a>.</p><h2 id="Shapes"><a class="docs-heading-anchor" href="#Shapes">Shapes</a><a id="Shapes-1"></a><a class="docs-heading-anchor-permalink" href="#Shapes" title="Permalink"></a></h2><h5 id="Needed-fields-4"><a class="docs-heading-anchor" href="#Needed-fields-4">Needed fields</a><a class="docs-heading-anchor-permalink" href="#Needed-fields-4" title="Permalink"></a></h5><ul><li><code>material::Material</code>: a <a href="../api/low-level/#Raytracer.Material"><code>Material</code></a> storing the informations on the material of the shape.</li><li><code>transformation::Transformation</code>: a <a href="../api/low-level/#Raytracer.Transformation"><code>Transformation</code></a> is the transformation that should be applied to every point of the unitary shape associated with the type (e.g., a sphere of radius one for the <a href="../api/low-level/#Raytracer.Sphere"><code>Sphere</code></a> shape) to be transformed in the desired shape.</li></ul><h5 id="Needed-methods-4"><a class="docs-heading-anchor" href="#Needed-methods-4">Needed methods</a><a class="docs-heading-anchor-permalink" href="#Needed-methods-4" title="Permalink"></a></h5><ul><li><code>ray_intersection(::Ray, ::NewShape)</code>: return an <a href="../api/low-level/#Raytracer.HitRecord"><code>HitRecord</code></a> of the nearest ray intersection with the given <a href="../api/low-level/#Raytracer.Shape"><code>Shape</code></a>.</li><li><code>all_ray_intersections(::Ray, ::NewShape)</code>: return a <code>Vector</code> of <a href="../api/low-level/#Raytracer.HitRecord"><code>HitRecord</code></a>s of all the ray intersections with the given <a href="../api/low-level/#Raytracer.Shape"><code>Shape</code></a> for every finite value of <code>t</code>, even outside of the ray domain.</li><li><code>quick_ray_intersection(::Ray, ::NewShape)</code>: return whether the ray intersects the given <a href="../api/low-level/#Raytracer.Shape"><code>Shape</code></a>.</li><li><code>get_all_ts(::NewShape, ::Ray)</code>: return a <code>Vector</code> of the hit parameter <code>t</code> against the given <a href="../api/low-level/#Raytracer.Shape"><code>Shape</code></a>, even outside of the ray domain.</li></ul><p>Furthermore, if you want to make your <code>NewShape</code> a subtype of <a href="../devs/private-api/#Raytracer.SimpleShape"><code>SimpleShape</code></a> you should also implement the following methods:</p><ul><li><code>get_t(::Type{NewShape}, ::Ray)</code>: return the parameter <code>t</code> at which <a href="../api/low-level/#Raytracer.Ray"><code>Ray</code></a> first hits the unitary <a href="../devs/private-api/#Raytracer.SimpleShape"><code>SimpleShape</code></a>. If no hit exists, return <code>Inf32</code>.</li><li><code>get_all_ts(::Type{NewShape}, ::Ray)</code>: return a <code>Vector</code> of the hit parameter <code>t</code> against the unitary shape of the given <a href="../devs/private-api/#Raytracer.SimpleShape"><code>SimpleShape</code></a> type, even outside of the ray domain.</li><li><code>get_normal(::Type{NewShape}, ::Point, ::Ray)</code>: return the <a href="../api/low-level/#Raytracer.Normal"><code>Normal{true}</code></a> of a shape given a point on its surface and the ray that hits it.</li><li><code>get_uv(::Type{NewShape}, ::Point)</code>: return the uv coordinates of a shape associated with the given point on its surface.</li></ul><h5 id="Further-notes-4"><a class="docs-heading-anchor" href="#Further-notes-4">Further notes</a><a class="docs-heading-anchor-permalink" href="#Further-notes-4" title="Permalink"></a></h5><p>We suggest to implement any new composite shape as a subtype to <a href="../devs/private-api/#Raytracer.CompositeShape"><code>CompositeShape</code></a> instead of directly subtyping <a href="../api/low-level/#Raytracer.Shape"><code>Shape</code></a>.</p><p>See documentation and source code of <a href="../api/low-level/#Raytracer.Shape"><code>Shape</code></a>, <a href="../devs/private-api/#Raytracer.SimpleShape"><code>SimpleShape</code></a>, and <a href="../devs/private-api/#Raytracer.CompositeShape"><code>CompositeShape</code></a>.</p><h2 id="Examples-of-extendability"><a class="docs-heading-anchor" href="#Examples-of-extendability">Examples of extendability</a><a id="Examples-of-extendability-1"></a><a class="docs-heading-anchor-permalink" href="#Examples-of-extendability" title="Permalink"></a></h2><p>Take a look to the examples folder in the repository to see an example (see <code>examples\extendability\renderers</code>), also reported below here.</p><pre><code class="language-julia">using Raytracer
using Raytracer.Interpreter

&quot;&quot;&quot;
    FoggyRenderer &lt;: Renderer

A `Renderer` that returns the color of the `Shape` first hit by a given `Ray` mixed with the fog_color depending on distance travelled.

This renderer returns the color stored in the `material` field of the `Shape` first hit by the given `Ray` at the hit point.
To this renderer there is no difference between radiated light and reflected color. There are no shades, diffusions or reflections.
The color is then mixed with the `fog color` using the formula
``(1-\\exp{-t/λ}) fog_color + \\exp{-t/λ} hit_color``
where `t` is the distance to the hit point and `λ` is the luminosity falloff.
If there are no hits this renderer returns the value of its field `fog_color`.

# Fields

- `world::World`: the `World` to render.
- `fog_color::RGB{Float32}`: color of the fog.
- `falloff::Float32`: color falloff
&quot;&quot;&quot;
struct FoggyRenderer &lt;: Renderer
    world::World
    fog_color::RGB{Float32}
    falloff::Float32
end

@doc &quot;&quot;&quot;
    FoggyRenderer(world::World, fog_color::RGB{Float32}, falloff::Float32)

Constructor for a `FoggyRenderer` instance.
&quot;&quot;&quot; FoggyRenderer(::World, ::RGB{Float32}, ::Float32)

&quot;&quot;&quot;
    FoggyRenderer(world::World; fog_color::RGB{Float32} = BLACK, falloff::Float32 = 1f0)

Constructor for a `FoggyRenderer` instance.

If no color is specified, it will default on [`BLACK`](@ref).
&quot;&quot;&quot;
FoggyRenderer(world::World; fog_color::RGB{Float32} = BLACK, falloff::Float32 = 1f0) = FlatRenderer(world, fog_color, falloff)

&quot;&quot;&quot;
    (oor::FoggyRenderer)(ray::Ray)

Render a `Ray` and return a `RBG{Float32}`.
&quot;&quot;&quot;
function (fr::FoggyRenderer)(ray::Ray)
    hit = ray_intersection(ray, fr.world)
    isnothing(hit) &amp;&amp; return fr.fog_color
    hit_color = hit.material.emitted_radiance(hit.surface_point) + hit.material.brdf.pigment(hit.surface_point)
    t = hit.t/fr.falloff
    fr.fog_color * (1 - exp(-t)) + hit_color * exp(-t)
end

scene = open_stream(parse_scene, &quot;test_scene.sl&quot;)

image_tracer = ImageTracer(scene.image, scene.camera; scene.tracer.kwargs...)
renderer = FoggyRenderer(scene.world, WHITE, 10f0)
render(image_tracer, renderer, output_file=&quot;foggy_renderer_out.pfm&quot;)
tonemapping(&quot;foggy_renderer_out.pfm&quot;, &quot;foggy_renderer_out.jpg&quot;, luminosity = 0.5f0)</code></pre><p>Which outputs the following image:</p><p><img src="https://i.imgur.com/T3UmNOO.jpg" alt/></p><p>As you can see, to extend the package one only needs to implement the required subtypes and methods. This is called &quot;type piracy&quot; and is a powerful feature of Julia.</p><p>We provided the basic instructions for rendering use, but made so that it is easy for anyone knowing the basics of Julia to build upon these fundations according to their needs.</p><p>Detailed instructions on how to implement new simple and composite shapes are also written in the <code>src/shapes.jl</code> file.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../api/low-level/">« Low-level API</a><a class="docs-footer-nextpage" href="../devs/collab/">Collaboration instructions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.3 on <span class="colophon-date" title="Saturday 3 July 2021 19:09">Saturday 3 July 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
